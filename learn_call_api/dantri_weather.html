<html>
  <head>
    <title>Trần Hạc Hương Thư</title>
    <script type="text/javascript">
      function get_weather_api() {
        var xhr = new XMLHttpRequest();
        xhr.open("get", "https://webapi.dantri.com.vn/misc", true);
        xhr.send();
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            var my_div = document.getElementById("my_div");
            var string_json = xhr.responseText;
            my_div.innerText = string_json;

            var object_json = JSON.parse(string_json);
            var weathers = object_json.weathers;

            display_weather(weathers);
          }
        };
      }

      function display_weather(weathers) {
        var tbody = document.getElementById("weather_tbody");
        // Làm sạch nội dung cũ nếu có
        tbody.innerHTML = "";

        // Kiểm tra mảng
        if (!weathers || !weathers.length) return;

        for (var i = 0; i < weathers.length; i++) {
            var weather = weathers[i];

            var tr = document.createElement("tr");
            var td_city = document.createElement("td");
            var td_tem = document.createElement("td");
            var td_status = document.createElement("td");
            icon="https://openweathermap.org/img/wn/04d@2x.png"
            img_icon=document.createElement("img")+weather.icon+"@2x.png"
            img_icon.setAttribute("src",icon)
            td_icon.appendChild(img_icon)

            td_city.innerText = weather.name;
            td_tem.innerText = weather.temperature;
            td_status.innerText = weather.clouds;
            td_icon.innerText = weather.icon;

            tr.appendChild(td_city);
            tr.appendChild(td_tem);
            tr.appendChild(td_status);
            tr.appendChild(td_icon);

            weather_tbody.appendChild(tr);
        }
      }
    </script>
  </head>
  <body>
    <div id="my_div" style="height:150px;overflow-y:scroll;background-color:antiquewhite;"></div>

    <table border="1">
      <caption>Weathers:</caption>
      <thead>
        <tr>
          <th>City/Province</th>
          <th>Temperature</th>
          <th>Status</th>
          <th>Icon</th>
        </tr>
      </thead>
      <tbody id="weather_tbody"></tbody>
    </table>

    <script type="text/javascript">
      get_weather_api();
    </script>
  </body>
</html>
